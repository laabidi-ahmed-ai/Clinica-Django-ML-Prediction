{% extends "Back/labo/base.html" %}

{% block content %}
<style>
/* GÃ©nÃ©ral */
body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    background-color: #F5F7FA;
}

/* Stats Cards */
.card {
    border-radius: 12px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    padding: 24px;
}

.card h6 {
    color: #94A3B8;
    font-size: 14px;
    margin-bottom: 8px;
}

.card h2 {
    color: #5B5FED;
    font-size: 36px;
    font-weight: 700;
}

/* Charts Containers */
canvas {
    width: 100% !important;
    height: 350px !important; /* agrandir les graphiques */
}

/* Pie chart centrÃ© et plus petit cercle */
#etatChart {
    max-width: 350px;
    max-height: 350px;
    margin: 0 auto;
}

/* Bar charts */
#typeChart, #budgetChart {
    max-height: 350px;
}

/* Cards marges */
.row.mb-5 > .col-md-6, .row.mb-5 > .col-md-12 {
    margin-bottom: 20px;
}

/* Responsive */
@media (max-width: 768px) {
    canvas {
        height: 300px !important;
    }
}
</style>

<h2 class="text-center my-4">ðŸ“Š Tableau de bord des Recherches</h2>

<div class="row text-center mb-5">
    <div class="col-md-4"><div class="card p-3 shadow-sm"><h6>Total Recherches</h6><h2>{{ total_recherches }}</h2></div></div>
    <div class="col-md-4"><div class="card p-3 shadow-sm"><h6>Budget Total</h6><h2>{{ total_budget }} â‚¬</h2></div></div>
    <div class="col-md-4"><div class="card p-3 shadow-sm"><h6>En cours</h6><h2>{{ pourcentage_en_cours }}%</h2></div></div>
</div>

<div class="row mb-5">
    <div class="col-md-6">
        <canvas id="typeChart"></canvas>
    </div>
    <div class="col-md-6">
        <canvas id="etatChart"></canvas>
    </div>
</div>

<div class="row mb-5">
    <div class="col-md-12">
        <canvas id="budgetChart"></canvas>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const typeChart = new Chart(document.getElementById('typeChart'), {
    type: 'bar',
    data: {
        labels: {{ type_labels|safe }},
        datasets: [{label: 'Nombre de recherches', data: {{ type_counts|safe }}, backgroundColor: '#4f46e5'}]
    },
    options: {responsive: true}
});

const etatChart = new Chart(document.getElementById('etatChart'), {
    type: 'pie',
    data: {
        labels: {{ etat_labels|safe }},
        datasets: [{data: {{ etat_counts|safe }}, backgroundColor: ['#4f46e5','#f59e0b','#10b981','#ef4444']}]
    },
    options: {responsive: true}
});

const budgetChart = new Chart(document.getElementById('budgetChart'), {
    type: 'bar',
    data: {
        labels: {{ budget_labels|safe }},
        datasets: [{label: 'Budget', data: {{ budget_values|safe }}, backgroundColor: '#f59e0b'}]
    },
    options: {responsive: true}
});
</script>

<a href="{% url 'Labapp:back_recherche_list' %}" class="btn btn-secondary mt-4 d-block mx-auto">â¬… Retour Ã  la liste</a>

{% endblock %}


