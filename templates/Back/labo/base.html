
<!DOCTYPE html>
<html dir="ltr" lang="en">

<head>
    {% load static %}
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- Tell the browser to be responsive to screen width -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <!-- Favicon icon -->
    <link rel="icon" type="image/png" sizes="16x16" href="{% static 'Back/src/assets/images/favicon.png' %}">
    <title>Freedash Template - The Ultimate Multipurpose admin template</title>
    <!-- Custom CSS -->
    <link href="{% static 'Back/src/assets/extra-libs/c3/c3.min.css' %}" rel="stylesheet">
    <link href="{% static 'Back/src/assets/libs/chartist/dist/chartist.min.css' %}" rel="stylesheet">
    <link href="{% static 'Back/src/assets/extra-libs/jvector/jquery-jvectormap-2.0.2.css' %}" rel="stylesheet" />
    <!-- Custom CSS -->
    <link href="{% static 'Back/src/dist/css/style.min.css' %}" rel="stylesheet">
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->
<style>
  * {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
}

.navbar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1rem 2rem;
  background: #fff;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  position: sticky;
  top: 0;
  z-index: 100;
}

.nav-right {
  display: flex;
  align-items: center;
  gap: 2rem;
}

.notification-wrapper {
  position: relative;
}

.notification-btn {
  position: relative;
  background: none;
  border: none;
  cursor: pointer;
  padding: 0.5rem;
  border-radius: 50%;
  transition: background 0.2s;
  color: #333;
}

.notification-btn:hover {
  background: #f5f5f5;
}

.notification-btn svg {
  display: block;
}

.notification-badge {
  position: absolute;
  top: 2px;
  right: 2px;
  background: #e74c3c;
  color: white;
  border-radius: 10px;
  padding: 2px 6px;
  font-size: 11px;
  font-weight: bold;
  min-width: 18px;
  text-align: center;
}

.notification-dropdown {
  position: absolute;
  top: calc(100% + 10px);
  right: 0;
  width: 380px;
  background: white;
  border-radius: 8px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  display: none;
  max-height: 500px;
  overflow: hidden;
}

.notification-dropdown.show {
  display: block;
}

.notification-header {
  padding: 1rem 1.25rem;
  border-bottom: 1px solid #eee;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.notification-header h3 {
  font-size: 1.1rem;
  font-weight: 600;
}

.notification-count {
  color: #3498db;
  font-size: 0.85rem;
  font-weight: 500;
}

.notification-list {
  max-height: 400px;
  overflow-y: auto;
}

.notification-item {
  display: flex;
  gap: 1rem;
  padding: 1rem 1.25rem;
  border-bottom: 1px solid #f5f5f5;
  position: relative;
  transition: background 0.2s;
}

.notification-item:hover {
  background: #f9f9f9;
}

.notification-item.unread {
  background: #f0f8ff;
}

.notification-icon {
  width: 36px;
  height: 36px;
  border-radius: 50%;
  background: #3498db;
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  flex-shrink: 0;
}

.notification-content {
  flex: 1;
}

.notification-content h4 {
  font-size: 0.95rem;
  margin-bottom: 0.25rem;
  font-weight: 600;
}

.notification-content p {
  font-size: 0.85rem;
  color: #666;
  margin-bottom: 0.25rem;
}

.notification-time {
  font-size: 0.75rem;
  color: #999;
}

.notification-close {
  background: none;
  border: none;
  font-size: 1.5rem;
  color: #999;
  cursor: pointer;
  padding: 0;
  width: 24px;
  height: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
  transition: all 0.2s;
}

.notification-close:hover {
  background: #f5f5f5;
  color: #333;
}

.user-menu {
  display: flex;
  align-items: center;
  gap: 1rem;
}

.user-name {
  font-weight: 500;
}

.logout-btn {
  padding: 0.5rem 1rem;
  background: #e74c3c;
  color: white;
  text-decoration: none;
  border-radius: 4px;
  transition: background 0.2s;
}

.logout-btn:hover {
  background: #c0392b;
}

.sidebar {
  position: fixed;
  left: 0;
  top: 60px;
  width: 250px;
  height: calc(100vh - 60px);
  background: #2c3e50;
  overflow-y: auto;
  padding: 1rem 0;
}

.menu {
  list-style: none;
}

.menu-section {
  margin-bottom: 1.5rem;
}

.menu-section h3 {
  color: #95a5a6;
  font-size: 0.75rem;
  font-weight: 600;
  padding: 0.5rem 1.5rem;
  letter-spacing: 1px;
}

.menu-section ul {
  list-style: none;
}

.menu-section li a {
  display: block;
  padding: 0.75rem 1.5rem;
  color: #ecf0f1;
  text-decoration: none;
  transition: background 0.2s;
}

.menu-section li a:hover {
  background: #34495e;
}

.main-content {
  margin-left: 250px;
  padding: 2rem;
  margin-top: 60px;
}
    
/* Backdrop */
.modal {
    display: none; /* hidden by default */
    position: fixed;
    inset: 0;
    background: rgba(139, 224, 228, 0.5);
    backdrop-filter: blur(4px);
    justify-content: center;
    align-items: center;
    z-index: 1000;
}

/* Modal container */
.modal-content {
    background: #fff;
    border-radius: 0.5rem;
    width: 500px;
    max-width: 90%;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 5px 15px rgba(117, 172, 186, 0.3);
    position: relative;
    padding: 1.5rem;
}

/* Modal header */
.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid #e5e7eb;
    padding-bottom: 0.5rem;
    margin-bottom: 1rem;
}

/* Close button */
.close-btn {
    cursor: pointer;
    font-size: 1.25rem;
    font-weight: bold;
    padding: 0.25rem;
    border-radius: 0.375rem;
    transition: background 0.2s;
}
.close-btn:hover {
    background: #f3f4f6;
}

/* Modal footer */
.modal-footer {
    display: flex;
    gap: 0.5rem;
    justify-content: flex-end;
    border-top: 1px solid #e5e7eb;
    padding-top: 0.5rem;
}
.modal-footer button {
    padding: 0.5rem 1rem;
    border-radius: 0.375rem;
    font-weight: 500;
    border: none;
    cursor: pointer;
    transition: background 0.2s;
}
.save-btn {
    background: #4f46e5;
    color: white;
}
.save-btn:hover {
    background: #4338ca;
}
.close-btn-footer {
    background: #eaeef4;
    color: white;
}
.close-btn-footer:hover {
    background: #d1d4d8;
}

/* ================= Popups Modern White ================= */
.modal {
    display: none;
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.4); /* overlay sombre */
    backdrop-filter: blur(8px);
    justify-content: center;
    align-items: center;
    z-index: 10000;
    animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

.modal-content {
    background: #ffffff; /* Blanc pur */
    border-radius: 20px;
    padding: 30px 40px;
    max-width: 550px;
    width: 100%;
    max-height: 90%;
    overflow-y: auto;
    box-shadow: 0 12px 28px rgba(0,0,0,0.25);
    position: relative;
    animation: slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1);
}

@keyframes slideUp {
    from { opacity: 0; transform: translateY(30px) scale(0.95); }
    to { opacity: 1; transform: translateY(0) scale(1); }
}

/* Close button */
.close-btn {
    position: absolute;
    top: 15px;
    right: 15px;
    width: 35px;
    height: 35px;
    border: none;
    background: #f0f0f0;
    border-radius: 50%;
    cursor: pointer;
    font-weight: bold;
    font-size: 18px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
}

.close-btn:hover {
    background: #e0e0e0;
    transform: rotate(90deg);
}

.close-btn::before,
.close-btn::after {
    content: '';
    position: absolute;
    width: 16px;
    height: 2px;
    background: #333;
    border-radius: 2px;
}

.close-btn::before { transform: rotate(45deg); }
.close-btn::after { transform: rotate(-45deg); }

/* Header */
.popup-header {
    margin-bottom: 25px;
    text-align: center;
}

.popup-title {
    font-size: 24px;
    font-weight: 600;
    margin-bottom: 5px;
    color: #222;
}

.popup-code {
    font-size: 14px;
    font-weight: 400;
    color: #555;
}

/* Details grid */
.details-grid {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.detail-item {
    background: #f8f8f8;
    border-radius: 12px;
    padding: 15px 20px;
    border: 1px solid #e0e0e0;
    transition: all 0.3s ease;
}

.detail-item:hover {
    background: #f0f0f0;
    transform: translateY(-2px);
    box-shadow: 0 6px 12px rgba(0,0,0,0.08);
}

.detail-label {
    font-size: 12px;
    font-weight: 600;
    color: #555;
    text-transform: uppercase;
    margin-bottom: 5px;
}

.detail-value {
    font-size: 16px;
    font-weight: 500;
    color: #222;
}

/* Status badge */
.status-badge {
    display: inline-block;
    padding: 6px 12px;
    background: #e0f2ff;
    color: #0275d8;
    font-weight: 600;
    border-radius: 12px;
    font-size: 13px;
}
</style>



</head>

<body>
    <!-- ============================================================== -->
    <!-- Preloader - style you can find in spinners.css -->
    <!-- ============================================================== -->
    <div class="preloader">
        <div class="lds-ripple">
            <div class="lds-pos"></div>
            <div class="lds-pos"></div>
        </div>
    </div>
    <!-- ============================================================== -->
    <!-- Main wrapper - style you can find in pages.scss -->
    <!-- ============================================================== -->
    <div id="main-wrapper" data-theme="light" data-layout="vertical" data-navbarbg="skin6" data-sidebartype="full"
        data-sidebar-position="fixed" data-header-position="fixed" data-boxed-layout="full">
        <!-- ============================================================== -->
        <!-- Topbar header - style you can find in pages.scss -->
        <!-- ============================================================== -->
        <header class="topbar" data-navbarbg="skin6">
      <nav class="navbar top-navbar navbar-expand-lg">
        <div class="navbar-header" data-logobg="skin6">
          <a class="nav-toggler d-block d-lg-none" href="javascript:void(0)">
            <i class="ti-menu ti-close"></i>
          </a>
          <div class="navbar-brand">
            <a href="{% url 'back_index' %}">
              <img src="{% static 'Front/assets/images/logo_site.png' %}" alt="logo" class="img-fluid" style="width: 120px; margin-top: 30px;">
            </a>
          </div>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="navbar-nav float-end">
          <!-- Notification Button with Vibrating Icon -->
<li class="nav-item dropdown">
<a class="nav-link notif-btn" id="notifDropdown" data-bs-toggle="dropdown">
<i class="bi bi-bell-fill notif-icon"></i>
<span id="notifCount" class="badge bg-danger">0</span>
</a>
<ul id="notifList" class="dropdown-menu dropdown-menu-end"></ul>
</li>


  <style>
        /* ================= Popups Modern White ================= */
        #notificationModal {
            display: none;
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 15px 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            width: 320px;
            z-index: 9999;
            font-family: Arial, sans-serif;
            animation: popupSlide 0.35s ease;
        }

        @keyframes popupSlide {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        #notificationModal .modal-content {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        #notificationModal .modal-content div.icon {
            width: 45px;
            height: 45px;
            background: #1877F2;
            color: white;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 22px;
            font-weight: bold;
        }

        #notificationModal .modal-content .text {
            flex: 1;
        }

        #notificationModal .modal-content .text .title {
            font-weight: bold;
            font-size: 15px;
            color: #1c1e21;
        }

        #notificationModal .modal-content .text .message {
            font-size: 13px;
            color: #65676B;
            margin-top: 4px;
        }

        #notificationModal .modal-content button.close-btn {
            background: none;
            border: none;
            font-size: 18px;
            cursor: pointer;
            color: #65676B;
        }
    </style>
</head>

<body>

    <!-- Notification Popup -->
    <div id="notificationModal">
        <div class="modal-content">
            <div class="icon">!</div>
            <div class="text">
                <div class="title">Nouveau rapport disponible</div>
                <div class="message">Votre analyse a été complétée.</div>
            </div>
            <button class="close-btn" onclick="closeNotifModal()">×</button>
        </div>
    </div>

 <style>
        /* ================= Popups Modern White ================= */
        #notificationModal {
            display: none;
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 15px 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            width: 320px;
            z-index: 9999;
            font-family: Arial, sans-serif;
            animation: popupSlide 0.35s ease;
        }

        @keyframes popupSlide {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        #notificationModal .modal-content {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        #notificationModal .modal-content div.icon {
            width: 45px;
            height: 45px;
            background: #1877F2;
            color: white;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 22px;
            font-weight: bold;
        }

        #notificationModal .modal-content .text {
            flex: 1;
        }

        #notificationModal .modal-content .text .title {
            font-weight: bold;
            font-size: 15px;
            color: #1c1e21;
        }

        #notificationModal .modal-content .text .message {
            font-size: 13px;
            color: #65676B;
            margin-top: 4px;
        }

        #notificationModal .modal-content button.close-btn {
            background: none;
            border: none;
            font-size: 18px;
            cursor: pointer;
            color: #65676B;
        }
    </style>
<!-- Improved Notification Feature Code -->
<style>
/* Notification bell container */
.notif-btn {
position: relative;
cursor: pointer;
font-size: 22px;
color: #333;
display: inline-flex;
align-items: center;
}


/* Bell vibration */
@keyframes bellVibrate {
0% { transform: rotate(0); }
20% { transform: rotate(-15deg); }
40% { transform: rotate(15deg); }
60% { transform: rotate(-10deg); }
80% { transform: rotate(10deg); }
100% { transform: rotate(0); }
}


.bell-shake {
animation: bellVibrate 0.9s ease-in-out;
}


/* Notification badge */
.notif-badge {
position: absolute;
top: -6px;
right: -6px;
background: #e63946;
color: #fff;
font-size: 11px;
font-weight: bold;
padding: 3px 6px;
border-radius: 50%;
box-shadow: 0 0 8px rgba(230,57,70,0.5);
animation: badgePop 0.4s ease;
}


@keyframes badgePop {
from { transform: scale(0); }
to { transform: scale(1); }
}


/* Auto notification popup */
#notifModal {
display: none;
position: fixed;
inset: 0;
background: rgba(0,0,0,0.4);
backdrop-filter: blur(5px);
display: flex;
justify-content: center;
align-items: center;
z-index: 9999;
}


#notifModal .modal-content {
background: white;
padding: 25px;
border-radius: 15px;
width: 420px;
animation: popupSlide 0.35s ease;
}


@keyframes popupSlide {
from { opacity: 0; transform: translateY(25px); }
to { opacity: 1; transform: translateY(0); }
}
</style>
        </ul>
    </li>

  
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="javascript:void(0)" data-bs-toggle="dropdown">
                <img src="{% static 'Back/src/assets/images/users/profile-pic.jpg' %}" alt="user" class="rounded-circle" width="40">
                <span class="ms-2 d-none d-lg-inline-block">
                  <span class="text-dark">{{ user.first_name|default:"Admin" }}</span>
                  <i data-feather="chevron-down" class="svg-icon"></i>
                </span>
              </a>
              <div class="dropdown-menu dropdown-menu-end">
                <a class="dropdown-item" href="#">
                  <i data-feather="power" class="svg-icon me-2"></i>Logout
                </a>
              </div>
            </li>
          </ul>
        </div>
      </nav>
    </header>
        <!-- Sidebar -->
    <aside class="left-sidebar" data-sidebarbg="skin6">
  <div class="scroll-sidebar" data-sidebarbg="skin6">
    <nav class="sidebar-nav">
      <ul id="sidebarnav">
        

        <li class="list-divider"></li>

        <!-- USER MANAGEMENT -->
        <li class="nav-small-cap"><span class="hide-menu">USER MANAGEMENT</span></li>
        <li class="sidebar-item">
          <a class="sidebar-link" href="{% url 'dashboard' %}">
            <i data-feather="users" class="feather-icon"></i>
            <span class="hide-menu">Users Management</span>
          </a>
        </li>

        <li class="list-divider"></li>
        <li class="nav-small-cap"><span class="hide-menu">PATIENT</span></li>
        <li class="sidebar-item">
            <a class="sidebar-link" href="{% url 'dashboard_home' %}" aria-expanded="false">
            <i data-feather="home" class="feather-icon"></i>
            <span class="hide-menu">Patient Dashboard</span>
            </a>
        </li>
        <li class="sidebar-item">
            <a class="sidebar-link" href="{% url 'appointment_list' %}">
            <i data-feather="calendar" class="feather-icon"></i>
            <span class="hide-menu">Appointments List</span>
            </a>
        </li>
        <li class="sidebar-item">
            <a class="sidebar-link" href="{% url 'patient_list' %}">
            <i data-feather="users" class="feather-icon"></i>
            <span class="hide-menu">Patients List</span>
            </a>
        </li>
        <li class="sidebar-item">
            <a class="sidebar-link" href="{% url 'appointment_create' %}">
            <i data-feather="plus-circle" class="feather-icon"></i>
            <span class="hide-menu">New Appointment</span>
            </a>
        </li>
         <li class="list-divider"></li>
        <!-- PRODUCTS -->
        <li class="nav-small-cap"><span class="hide-menu">PRODUCTS</span></li>
        <li class="sidebar-item">
          <a class="sidebar-link" href="{% url 'dashboard_products' %}">
            <i data-feather="home" class="feather-icon"></i>
            <span class="hide-menu">Product Dashboard</span>
          </a>
        </li>
        <li class="sidebar-item">
          <a class="sidebar-link" href="{% url 'products_list' %}">
            <i data-feather="package" class="feather-icon"></i>
            <span class="hide-menu">Products List</span>
          </a>
        </li>
        <li class="sidebar-item">
          <a class="sidebar-link" href="{% url 'orders_list' %}">
            <i data-feather="shopping-cart" class="feather-icon"></i>
            <span class="hide-menu">Orders List</span>
          </a>
        </li>

        <li class="list-divider"></li>


        <!-- DONATIONS -->
        <li class="nav-small-cap"><span class="hide-menu">DONATIONS</span></li>

        <li class="sidebar-item">
          <a class="sidebar-link" href="{% url 'donation:back_index' %}">
            <i data-feather="activity" class="feather-icon"></i>
            <span class="hide-menu">Dashboard Donation</span>
          </a>
        </li>
        <li class="sidebar-item">
          <a class="sidebar-link" href="{% url 'publication:publication_list' %}">
            <i data-feather="file-text" class="feather-icon"></i>
            <span class="hide-menu">Publications List</span>
          </a>
        </li>
         <li class="sidebar-item">
          <a class="sidebar-link" href="{% url 'publication:publication_form' %}">
            <i data-feather="plus-circle" class="feather-icon"></i>
            <span class="hide-menu">New Publication</span>
          </a>
        </li>
        <li class="sidebar-item">
          <a class="sidebar-link" href="{% url 'donation:admin_donation_list' %}">
            <i data-feather="heart" class="feather-icon"></i>
            <span class="hide-menu">Donations List</span>
          </a>
        </li>

        <li class="list-divider"></li>

        <li class="nav-small-cap"><span class="hide-menu">LABO</span></li>
        <li class="sidebar-item">
            <a class="sidebar-link" href="{% url 'Labapp:back_analyse_list' %}" aria-expanded="false">
            <i data-feather="calendar" class="feather-icon"></i>
            <span class="hide-menu">List Analyses</span>
            </a>
        </li>
        <li class="sidebar-item">
            <a class="sidebar-link" href="{% url 'Labapp:back_recherche_list' %}">
            <i data-feather="tag" class="feather-icon"></i>
            <span class="hide-menu">recherche List</span>
            </a>
        </li>

        <li class="list-divider"></li>
        
         <li class="nav-small-cap"><span class="hide-menu">STAGE</span></li>
        <li class="sidebar-item">
  <a class="sidebar-link" href="{% url 'stages:liste_stages' %}">
    <i data-feather="award" class="feather-icon"></i>
    <span class="hide-menu">Stages List</span>
  </a>
</li>

        <li class="sidebar-item">
  <a class="sidebar-link" href="{% url 'stages:ajouter_stage' %}">
    <i data-feather="award" class="feather-icon"></i>
    <span class="hide-menu">New Stage</span>
  </a>
</li>
<li class="sidebar-item">
  <a class="sidebar-link" href="{% url 'stagiaire:liste_stagiaires' %}">
    <i data-feather="user-check" class="feather-icon"></i>
    <span class="hide-menu">Stagiaires List</span>
  </a>
</li>

        
      </ul>
    </nav>
  </div>
</aside>

                       <div class="page-wrapper">
        <div class="container-fluid">

            {% block content %}
            {% endblock %}

        </div>
    </div>

</div>
               
     {% load static %}
    <script src="{% static 'Back/src/assets/libs/jquery/dist/jquery.min.js' %}"></script>
    <script src="{% static 'Back/src/assets/libs/bootstrap/dist/js/bootstrap.bundle.min.js' %}"></script>
    <!-- apps -->
    <!-- apps -->
    <script src="{% static 'Back/src/dist/js/app-style-switcher.js' %}"></script>
    <script src="{% static 'Back/src/dist/js/feather.min.js' %}"></script>
    <script src="{% static 'Back/src/assets/libs/perfect-scrollbar/dist/perfect-scrollbar.jquery.min.js' %}"></script>
    <script src="{% static 'Back/src/dist/js/sidebarmenu.js' %}"></script>
    <!--Custom JavaScript -->
    <script src="{% static 'Back/src/dist/js/custom.min.js' %}"></script>
    <!--This page JavaScript -->
    <script src="{% static 'Back/src/assets/extra-libs/c3/d3.min.js' %}"></script>
    <script src="{% static 'Back/src/assets/extra-libs/c3/c3.min.js' %}"></script>
    <script src="{% static 'Back/src/assets/libs/chartist/dist/chartist.min.js' %}"></script>
    <script src="{% static 'Back/src/assets/libs/chartist-plugin-tooltips/dist/chartist-plugin-tooltip.min.js' %}"></script>
    <script src="{% static 'Back/src/assets/extra-libs/jvector/jquery-jvectormap-2.0.2.min.js' %}"></script>
    <script src="{% static 'Back/src/assets/extra-libs/jvector/jquery-jvectormap-world-mill-en.js' %}"></script>
    <script src="{% static 'Back/src/dist/js/pages/dashboards/dashboard1.min.js' %}"></script>
   <script src="{% static 'Back/src/dist/js/custom.min.js' %}"></script>
<!-- ... autres scripts ... -->
<script>
/* ------------ Notifications: fetch + afficher une fois (localStorage) ------------ */
async function loadNotifications() {
  try {
    const resp = await fetch("{% url 'Labapp:notifications_analyses_terminees' %}");
    if (!resp.ok) throw new Error("fetch failed: " + resp.status);
    const data = await resp.json();

    // DOM elements (gardes null-safe)
    const notifCount = document.getElementById('notifCount');
    const notifList = document.getElementById('notifList');
    const notifIcon = document.querySelector('.notif-icon');
    const centerModal = document.getElementById('notifModal');           // si présent (centre)
    const centerModalContent = document.getElementById('notifModalContent');
    const fbModal = document.getElementById('notificationModal');       // popup style Facebook (top-right)

    // update badge
    if (notifCount) notifCount.textContent = data.count ?? 0;

    // reset dropdown + center modal content safely
    if (notifList) notifList.innerHTML = '';
    if (centerModalContent) centerModalContent.innerHTML = '';

    // bell animation
    if (notifIcon) {
      if (data.count > 0) notifIcon.classList.add('bell-shake');
      else notifIcon.classList.remove('bell-shake');
    }

    // fill notification dropdown & modal content
    (data.analyses || []).forEach(a => {
      if (notifList) {
        const li = document.createElement('li');
        li.innerHTML = `<a class="dropdown-item" href="/analyse/${a.id}/">Analyse ${a.echantillon_code} terminée</a>`;
        notifList.appendChild(li);
      }
      if (centerModalContent) {
        const div = document.createElement('div');
        div.classList.add('detail-item');
        div.innerHTML = `
          <div class="detail-label">Échantillon</div>
          <div class="detail-value">${a.echantillon_code}</div>
          <div class="detail-label">Date</div>
          <div class="detail-value">${a.date_res}</div>`;
        centerModalContent.appendChild(div);
      }
    });

    /* ---------- Montrer le popup STYLE Facebook une SEULE fois ---------- */
    // si notifications > 0 et jamais affiché -> afficher (top-right fb modal)
    if (data.count > 0 && !localStorage.getItem('analysis_shown')) {
      if (fbModal) {
        fbModal.style.display = 'block';

        // auto-hide après 7s (optionnel)
        setTimeout(() => {
          fbModal.style.display = 'none';
        }, 7000);
      }
      localStorage.setItem('analysis_shown', 'true');
    }

    // reset localStorage if there are no notifications (pour permettre futures popups)
    if (data.count === 0) {
      localStorage.removeItem('analysis_shown');
      if (fbModal) fbModal.style.display = 'none';
    }

  } catch (err) {
    console.error("Erreur notifications:", err);
  }
}

/* fonction réutilisée pour fermer n'importe quel modal */
function closeNotifModal() {
  const centerModal = document.getElementById('notifModal');
  const fbModal = document.getElementById('notificationModal');
  if (centerModal) centerModal.style.display = 'none';
  if (fbModal) fbModal.style.display = 'none';
}

/* Lancement initial + intervalle */
loadNotifications();
setInterval(loadNotifications, 30000); // toutes les 30s, ajuste si tu veux
</script>

  <script>
        // Fonction pour afficher le popup
        function showNotifModal() {
            const modal = document.getElementById("notificationModal");
            modal.style.display = "block";

            // Cache automatiquement après 5 secondes (comme Facebook)
            setTimeout(() => {
                closeNotifModal();
            }, 5000);
        }

        // Fonction pour fermer
        function closeNotifModal() {
            const modal = document.getElementById("notificationModal");
            modal.style.display = "none";
        }

        // Affichage une seule fois par utilisateur
        window.onload = function () {
            if (!localStorage.getItem("notifShown")) {
                showNotifModal();
                localStorage.setItem("notifShown", "true"); // ne s'affiche plus après refresh
            }
        }
    </script>

</body>

</html>