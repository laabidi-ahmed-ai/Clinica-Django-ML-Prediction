{% load static %}
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/x-icon" href="{% static 'Front/assets/images/logo_site.ico' %}" />
    <title>Make a Donation - Clinica+</title>
    
    <!-- CSS -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;600;700&family=Open+Sans&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">

    
    <!-- Vendor CSS Files -->
    <link href="{% static 'Front/assets/vendor/bootstrap/css/bootstrap.min.css' %}" rel="stylesheet">
    <link href="{% static 'Front/assets/vendor/bootstrap-icons/bootstrap-icons.css' %}" rel="stylesheet">
    <link href="{% static 'Front/assets/vendor/aos/aos.css' %}" rel="stylesheet">
    <link href="{% static 'Front/assets/vendor/fontawesome-free/css/all.min.css' %}" rel="stylesheet">
    <link href="{% static 'Front/assets/vendor/glightbox/css/glightbox.min.css' %}" rel="stylesheet">
    <link href="{% static 'Front/assets/vendor/swiper/swiper-bundle.min.css' %}" rel="stylesheet">
    
    <!-- Main CSS File -->
    <link href="{% static 'Front/assets/css/main.css' %}" rel="stylesheet">
    
    <style>
        body {
            background-color: #f9f9f9;
            font-family: 'Open Sans', sans-serif;
        }
        
        .hero-section {
            position: relative;
            background-image: url('{% static "Front/assets/images/image.jpg" %}');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            height: 62vh;
            z-index: 1;
            margin-top: 10px;
        }
        
        .hero-section::before {
            content: "";
            position: absolute;
            top: 0; left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.4);
            z-index: 2;
        }
        
        .hero-section .container {
            position: relative;
            z-index: 3;
        }
        
        .btn-outline {
            padding: 10px 25px;
            border: 2px solid white;
            border-radius: 50px;
            color: white;
            background: transparent;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .btn-outline:hover {
            background: white;
            color: black;
        }
        
        .donation-section {
            background: #5a6f80;
            position: relative;
            overflow: hidden;
            padding: 50px 0;
        }
        
        .donation-section::after {
            content: "";
            background: #5bc1ac;
            border-radius: 50%;
            position: absolute;
            bottom: -110px;
            right: -80px;
            width: 350px;
            height: 350px;
        }
        
        .donation-form {
            background: #fff;
            border-radius: 20px;
            padding: 50px;
        }
        
        .donation-image {
            border-radius: 100%;
            display: block;
            margin: auto;
            width: 300px;
            height: 300px;
            object-fit: cover;
        }
        
        .section-title {
            color: #fff;
            text-align: center;
            font-size: 2.5rem;
            font-family: 'Georgia', serif;
            margin-bottom: 30px;
        }
        
        .amount-btn {
            background-color: #f4faff;
            border: 1px solid #d0e8f2;
            border-radius: 10px;
            padding: 10px 20px;
            font-weight: 500;
            transition: background 0.2s ease;
        }
        
        .amount-btn.active,
        .amount-btn:hover {
            background-color: #5a6f80;
            color: white;
        }
        
        .btn1 {
            background-color: #81bbb5;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 18px;
            border-radius: 15px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .btn1:hover {
            background-color: #8fd8d1;
        }
        
        .donation-card {
            background: #fff;
            border-radius: 15px;
            box-shadow: 0 5px 12px rgba(0, 0, 0, 0.05);
            height: 320px;
            display: flex;
            flex-direction: row;
            overflow: hidden;
            position: relative;
        }
        
        .donation-card.success {
            border: 3px solid #28a745;
        }
        
        .donation-card.echec {
            border: 3px solid #dc3545;
        }
        
        .status-icon {
            position: absolute;
            top: 1px;
            left: 1px;
            width: 45px;
            height: 45px;
            z-index: 2;
        }
        
        .donation-img {
            flex: 0 0 200px;
            max-width: 200px;
            overflow: hidden;
        }
        
        .donation-img img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .donation-details {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 10px;
            height: 100%;
            flex-grow: 1;
        }
        
        .donation-title {
            font-size: 1.2rem;
            color: #008b8b;
            font-weight: 600;
            margin-bottom: 10px;
            word-break: break-word;
        }
        
        .delete-btn {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .delete-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        /* Validation styles */
.is-valid {
    border-color: #28a745 !important;
    padding-right: calc(1.5em + 0.75rem);
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 8 8'%3e%3cpath fill='%2328a745' d='M2.3 6.73L.6 4.53c-.4-1.04.46-1.4 1.1-.8l1.1 1.4 3.4-3.8c.6-.63 1.6-.27 1.2.7l-4 4.6c-.43.5-.8.4-1.1.1z'/%3e%3c/svg%3e");
    background-repeat: no-repeat;
    background-position: right calc(0.375em + 0.1875rem) center;
    background-size: calc(0.75em + 0.375rem) calc(0.75em + 0.375rem);
}

.is-invalid {
    border-color: #dc3545 !important;
    padding-right: calc(1.5em + 0.75rem);
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 12 12' width='12' height='12' fill='none' stroke='%23dc3545'%3e%3ccircle cx='6' cy='6' r='4.5'/%3e%3cpath stroke-linejoin='round' d='M5.8 3.6h.4L6 6.5z'/%3e%3ccircle cx='6' cy='8.2' r='.6' fill='%23dc3545' stroke='none'/%3e%3c/svg%3e");
    background-repeat: no-repeat;
    background-position: right calc(0.375em + 0.1875rem) center;
    background-size: calc(0.75em + 0.375rem) calc(0.75em + 0.375rem);
}

.valid-feedback,
.invalid-feedback {
    display: none;
    font-size: 0.875rem;
    margin-top: 0.25rem;
}

.is-valid ~ .valid-feedback {
    display: block;
    color: #28a745;
}

.is-invalid ~ .invalid-feedback {
    display: block;
    color: #dc3545;
}

.char-counter {
    font-size: 0.875rem;
    color: #6c757d;
    margin-top: 0.25rem;
}

.char-counter.text-danger {
    color: #dc3545 !important;
}

.char-counter.text-success {
    color: #28a745 !important;
}
      
/* Section badges am√©lior√©e */
.badges-wrapper {
    display: flex;
    justify-content: center;
    width: 100%;
    padding: 60px 20px;
}

.badges-card {
    background: white;
    width: 100%;
    max-width: 1200px;
    padding: 50px 50px 60px;
    border-radius: 25px;
    box-shadow: 0px 15px 35px rgba(0,0,0,0.08);
    text-align: center;
    border-top: 6px solid #2ca4b4;
    border-bottom: 6px solid #2ca4b4;
}

.badges-title {
    font-size: 38px;
    font-weight: 700;
    color: #2ca4b4;
    margin-bottom: 10px;
}

.badges-subtitle {
    font-size: 17px;
    color: #555;
    margin-bottom: 40px;
}

.badges-grid {
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    gap: 40px;
}

.badge-card {
    width: 180px;
    padding: 25px;
    background: #fff;
    border-radius: 18px;
    text-align: center;
    box-shadow: 0 8px 20px rgba(0,0,0,0.06);
    transition: 0.3s ease;
    border: 2px solid transparent;
}

.badge-card:hover {
    transform: translateY(-10px);
    border-color: #2ca4b4;
    box-shadow: 0 12px 25px rgba(0,0,0,0.15);
}

.badge-icon {
    font-size: 65px;
    margin-bottom: 14px;
}

.badge-name {
    font-size: 21px;
    font-weight: 600;
}

.badge-bronze { color: #cd7f32; }
.badge-silver { color: #9c9c9c; }
.badge-gold   { color: #d4af37; }
.badge-hero   { color: #ff0059; }

/* ========== SECTION YOUR DONATIONS AM√âLIOR√âE ========== */
#mydonation {
    background: linear-gradient(135deg, #f5f7fa 0%, #e4e8ec 100%);
    padding: 80px 0;
}

#mydonation h2 {
    color: #2CA4B4;
    text-align: center;
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 50px;
}

.donations-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
    gap: 30px;
    padding: 0 20px;
}

.donation-card-new {
    background: #fff;
    border-radius: 20px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08);
    overflow: hidden;
    position: relative;
    transition: all 0.3s ease;
    display: flex;
    flex-direction: column;
}

.donation-card-new:hover {
    transform: translateY(-8px);
    box-shadow: 0 20px 50px rgba(0, 0, 0, 0.15);
}

.donation-card-new.success {
    border-left: 5px solid #28a745;
}

.donation-card-new.echec {
    border-left: 5px solid #dc3545;
}

.donation-card-new.pending {
    border-left: 5px solid #ffc107;
}

.donation-card-img {
    width: 100%;
    height: 180px;
    object-fit: cover;
}

.donation-card-body {
    padding: 25px;
    flex-grow: 1;
    display: flex;
    flex-direction: column;
}

.donation-card-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 15px;
}

.donation-card-title {
    font-size: 1.1rem;
    color: #2CA4B4;
    font-weight: 700;
    margin: 0;
    line-height: 1.4;
    flex: 1;
    padding-right: 10px;
}

.status-badge {
    padding: 6px 14px;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.status-badge.valide {
    background: linear-gradient(135deg, #28a745, #20c997);
    color: white;
}

.status-badge.echec {
    background: linear-gradient(135deg, #dc3545, #e74c3c);
    color: white;
}

.status-badge.en_attente {
    background: linear-gradient(135deg, #ffc107, #ffca2c);
    color: #333;
}

/* --- YOUR DONATIONS (new premium design) --- */

.donations-wrapper {
    max-width: 1200px;
    margin: 0 auto;
}

.donations-title {
    font-size: 40px;
    font-weight: 700;
    text-align: center;
    margin-bottom: 50px;
    color: #2CA4B4;
}

/* Grid responsive */
.donations-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(480px, 1fr));
    gap: 30px;
}

/* New donation card */
.donation-card2 {
    background: #fff;
    border-radius: 22px;
    padding: 20px;
    display: flex;
    gap: 20px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.08);
    border-left: 6px solid transparent;
    transition: 0.25s ease;
}

.donation-card2:hover {
    transform: translateY(-6px);
    box-shadow: 0 14px 30px rgba(0,0,0,0.12);
}

/* Status borders */
.donation-success { border-left-color: #28a745; }
.donation-pending { border-left-color: #fbc02d; }
.donation-fail    { border-left-color: #dc3545; }

/* Image */
.donation-thumb {
    width: 150px;
    height: 150px;
    flex-shrink: 0;
    border-radius: 18px;
    overflow: hidden;
}

.donation-thumb img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

/* Content */
.donation-info h4 {
    font-size: 20px;
    color: #008b8b;
    font-weight: 700;
}

.donation-info p {
    margin: 3px 0;
    font-size: 14.8px;
    color: #444;
}

/* Delete button */
.delete-btn2 {
    background: #ff4d4d;
    color: white;
    border: none;
    width: 45px;
    height: 45px;
    display: flex;
    justify-content: center;
    align-items: center;
    border-radius: 14px;
    cursor: pointer;
    transition: 0.2s ease;
    margin-left: auto;
}

.delete-btn2:hover {
    background: #e60000;
    transform: scale(1.05);
}

/* Status text */
.status-green  { color: #28a745; font-weight: 600; }
.status-yellow { color: #FFC107; font-weight: 600; }
.status-red    { color: #DC3545; font-weight: 600; }

/* CARD DONATION ‚Äî STYLE EXACT COMME SCREENSHOT */
.donation-item {
    background: #fff;
    border-radius: 15px;
    padding: 22px;
    box-shadow: 0 3px 10px rgba(0,0,0,0.07);
    margin-bottom: 20px;
}

.donation-item h5 {
    font-size: 1.1rem;
    font-weight: 700;
    color: #008B8B;
    margin: 0;
}

.badge-status {
    padding: 6px 16px;
    border-radius: 20px;
    font-size: 0.85rem;
    font-weight: 600;
    display: inline-flex;     /* emp√™che la coupure */
    align-items: center;      /* centre le check */
    gap: 6px;                 /* espace check + texte */
    white-space: nowrap;      /* emp√™che retour √† la ligne ‚ùó */
}


.badge-valide { background: #26C281; color: white; }
.badge-echec { background: #E74C3C; color: white; }
.badge-attente { background: #F1C40F; color: #444; }
/* ======= NEW DONATION CARD (STYLE SCREENSHOT) ======= */
.donation-item {
    background: #fff;
    border-radius: 18px;
    padding: 25px;
    box-shadow: 0 5px 18px rgba(0,0,0,0.06);
    margin-bottom: 20px;
    border-left: 6px solid transparent;
    transition: 0.25s ease;
}

.donation-item.valide   { border-left-color: #26C281; }
.donation-item.echec    { border-left-color: #E74C3C; }
.donation-item.attente  { border-left-color: #F1C40F; }

.donation-title-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: nowrap;
}



.badge-status {
    padding: 6px 16px;
    border-radius: 20px;
    font-size: 0.85rem;
    font-weight: 600;
}

.badge-valide { background: #26C281; color: white; }
.badge-echec  { background: #E74C3C; color: white; }
.badge-attente{ background: #F1C40F; color: #444; }

.donation-icons {
    display: flex;
    gap: 25px;
    margin-top: 10px;
    font-size: 0.95rem;
}

.donation-icons i {
    color: #2CA4B4;
    margin-right: 6px;
}

.separator-line {
    width: 100%;
    border-bottom: 1px solid #e1e1e1;
    margin: 15px 0;
}

.amount-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: nowrap;
}

.amount-text {
    font-size: 1.8rem;
    font-weight: 700;
    color: #2CA4B4;
}

.delete-circle {
    background: #E74C3C;
    width: 48px;
    height: 48px;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    color: white;
    border: none;
    cursor: pointer;
    font-size: 1.2rem;
    transition: 0.3s;
}

.delete-circle:hover {
    transform: scale(1.08);
    box-shadow: 0 3px 8px rgba(231,76,60,0.4);
}
/* IMAGE GAUCHE DANS LA CARTE DONATION */
.donation-left-image {
    width: 120px;
    height: 120px;
    border-radius: 15px;
    object-fit: cover;
   
    background: white;
}

.delete-header {
  background: linear-gradient(135deg, #dc3545, #c82333);
  color: white;
}

.delete-modal-body {
  text-align: center;
  padding: 40px 30px;
}

.icon-wrapper {
  width: 80px;
  height: 80px;
  margin: 0 auto 20px;
  border-radius: 50%;
  display: flex;
  justify-content: center;
  align-items: center;
}

.delete-icon {
  background: linear-gradient(135deg, #dc3545, #c82333);
  color: white;
  box-shadow: 0 8px 20px rgba(220,53,69,0.3);
}

.modal-footer .btn {
  min-width: 120px;
  padding: 10px 24px;
  border-radius: 8px;
  font-weight: 500;
}

    </style>
</head>

<body id="top">
    <!-- Header -->
    <header id="header" class="header sticky-top">
        <div class="topbar d-flex align-items-center">
            <div class="container d-flex justify-content-center justify-content-md-between">
                <div class="d-none d-md-flex align-items-center">
                    <i class="bi bi-clock me-1"></i> Monday - Saturday, 8AM to 10PM
                </div>
                <div class="d-flex align-items-center">
                    <i class="bi bi-phone me-1"></i> Call us now +1 5589 55488 55
                </div>
            </div>
        </div>

        <div class="branding d-flex align-items-center">
            <div class="container position-relative d-flex align-items-center justify-content-end">
                <a href="{% url 'front_index' %}" class="logo d-flex align-items-center me-auto">
                    <img src="{% static 'Front/assets/images/logo_site.png' %}" alt="" style="width: 120px; height: 90px;">
                </a>

                <nav id="navmenu" class="navmenu">
                    <ul style="display: flex; align-items: center; list-style: none; margin: 0; padding: 0; gap: 30px;">
            <li><a href="{% url 'front_index' %}" style="text-decoration: none; color: #333; font-weight: 500; transition: color 0.3s;">HOME</a></li>
            <li><a href="#" style="text-decoration: none; color: #333; font-weight: 500; transition: color 0.3s;">ABOUT</a></li>
            <li><a href="{% url 'index' %}" style="text-decoration: none; color: #333; font-weight: 500;">PRODUCTS</a></li>
            <li><a href="{% url 'donation:front_publication_list' %}" class="active" style="text-decoration: none; color: #3fbbc0; font-weight: 600;">DONATION</a></li>
            <li><a href="{% url 'stages:liste_stages_front' %}" style="text-decoration: none; color: #333; font-weight: 500; transition: color 0.3s;">STAGE</a></li>
            <li><a href="{% url 'Labapp:home' %}" style="text-decoration: none; color: #333; font-weight: 500; transition: color 0.3s;">LABO</a></li>
            <li><a href="{% url 'my_patient_portal' %}" style="text-decoration: none; color: #333; font-weight: 500; transition: color 0.3s;">PATIENT</a></li>
          </ul>
                    <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
                </nav>

                <a class="cta-btn" href="{% url 'public_appointment' %}">Make an Appointment</a>
                
                {% if user.is_authenticated %}
                <div class="dropdown ms-3">
                    <a class="nav-link dropdown-toggle" href="#" id="profileDropdown" role="button" data-bs-toggle="dropdown">
                        <i class="fas fa-user-circle fa-lg" style="font-size: 34px;"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end">
                        <li><a class="dropdown-item" href="{% url 'donation:user_donation_list' %}">
                            <i class="fas fa-heart"></i> My Donations
                        </a></li>
                        <li><a class="dropdown-item" href="#">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </a></li>
                    </ul>
                </div>
                {% else %}
                <li><a href="{% url 'loginFront' %}" class="nav-auth-btn nav-login-btn" style="text-decoration: none; background: linear-gradient(135deg, #3fbbc0 0%, #2a9d9f 100%); color: white; font-weight: 600; padding: 8px 20px; border-radius: 25px; display: inline-block; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(63, 187, 192, 0.3);"><i class="bi bi-box-arrow-in-right"></i> LOGIN</a></li>
                {% endif %}
            </div>
        </div>
    </header>

    <main>
        <!-- Hero Section -->
        <section class="hero-section d-flex justify-content-center align-items-center">
            <div class="container">
                <div class="row">
                    <div class="col-lg-8 col-12 mx-auto text-center">
                        <h1 class="text-white">Welcome To The Donation Page</h1>
                        <h5 class="text-white">"Your Action Is A Life Saver!!"</h5>
                        <div class="button-container mt-4">
                            <button onclick="document.getElementById('mydonation').scrollIntoView({behavior: 'smooth'})" class="btn-outline me-2">
                                YOUR DONATIONS
                            </button>
                            <button onclick="document.getElementById('donation_form').scrollIntoView({behavior: 'smooth'})" class="btn-outline">
                                DONATE
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <div style="height: 50px;"></div>
        
        <!-- Donation Form Section -->
        <section class="donation-section" id="register">
            <div class="container">
                <h2 class="section-title mb-4">YOUR DONATION IS OTHERS INSPIRATION</h2>
                <div class="row">
                    <!-- Left: Form -->
                    <div class="col-lg-6 col-12">
                        <div class="donation-form">
                            <h3 class="mb-4 pb-2">Thank You For Your Donation</h3>
                            <form method="POST" id="donation_form">
                                {% csrf_token %}
                                {{ form.id_publication }}
                                
                                <div class="row">
                                    <!-- First Name -->
                                    <div class="col-lg-6 col-12">
                                        <div class="form-floating mb-3">
                                            <input type="text" class="form-control" value="{{ user.first_name }}" disabled>
                                            <label>First Name</label>
                                        </div>
                                    </div>
                                    
                                    <!-- Last Name -->
                                    <div class="col-lg-6 col-12">
                                        <div class="form-floating mb-3">
                                            <input type="text" class="form-control" value="{{ user.last_name }}" disabled>
                                            <label>Last Name</label>
                                        </div>
                                    </div>
                                    
                                    <!-- Email -->
                                    <div class="col-lg-12 col-12">
                                        <div class="form-floating mb-3">
                                            <input type="text" class="form-control" value="{{ user.email }}" disabled>
                                            <label>Email</label>
                                        </div>
                                    </div>
                                    
                                    <!-- Donation Type -->
                                    <div class="col-lg-6 col-12">
                                        <div class="form-floating mb-3">
                                            {{ form.type_donation }}
                                            <label>Donation Type</label>
                                        </div>
                                    </div>
                                    <div class="form-group">
    <label>Telegram Chat ID (optionnel)</label>
    {{ form.telegram_chat_id }}
    <small>Obtenez votre ID via @userinfobot sur Telegram</small>
</div>
<a class="btn btn-outline-success mb-3" href="{% url 'donation:telegram_connect' %}">
  ü§ñ Connect to Telegram
</a>

                                    <!-- Amount Selection -->
                                  
<div class="form-group mb-3" id="montant_field">
    <label class="form-label fw-semibold" style="color: #5bc1ac;">Select an amount</label>
    <div class="d-flex flex-wrap gap-2">
        <button type="button" class="amount-btn" data-value="10">10 DT</button>
        <button type="button" class="amount-btn" data-value="15">15 DT</button>
        <button type="button" class="amount-btn" data-value="20">20 DT</button>
        <button type="button" class="amount-btn" data-value="30">30 DT</button>
        <button type="button" class="amount-btn" data-value="45">45 DT</button>
        <button type="button" class="amount-btn" data-value="50">50 DT</button>
    </div>
    
    <div class="input-group mt-2">
        <span class="input-group-text">DT</span>
        {{ form.montant }}
    </div>
    <div class="text-start mt-1">
        <span id="usd_estimate" class="fw-semibold"></span>
    </div>
    <div class="invalid-feedback" id="montant-error">
        Le montant doit √™tre sup√©rieur √† 0.
    </div>
    <div class="valid-feedback">
        Montant valide!
    </div>
</div>

                                    
                                    <!-- Payment Method -->
                                    <div class="col-12" id="methode_field">
                                        <div class="form-floating mb-3">
                                            {{ form.methode_paiement }}
                                            <label>Payment Method</label>
                                        </div>
                                        <div id="stripe-payment-section" style="display:none; margin-top:1em;">
  <label for="card-element" class="form-label">Card Details</label>
  <div id="card-element"></div>
  <div id="card-errors" class="text-danger"></div>
</div>

                                        <div id="card-logos" class="text-center mt-2">
                                            <img src="{% static 'Front/assets/images/icons/visa.svg' %}" alt="Visa" style="height: 30px; margin-right: 10px;">
                                            <img src="{% static 'Front/assets/images/icons/mastercard.svg' %}" alt="MasterCard" style="height: 30px;">
                                            <p style="font-size: 0.9rem; color: gray;">We accept Visa and MasterCard</p>
                                        </div>
                                    </div>
                                    
                                    <!-- Description -->
<div class="col-12" id="description_field" style="display: none;">
    <div class="form-floating mb-4">
        {{ form.description }}
        <label>Description</label>
    </div>
    <div class="char-counter" id="char-counter">
        <span id="char-count">0</span> / 30 caract√®res minimum
    </div>
    <div class="invalid-feedback" id="description-error">
        La description doit contenir au moins 30 caract√®res.
    </div>
    <div class="valid-feedback">
        Description valide!
    </div>
</div>

                                    
                                    <!-- Submit -->
                                    <div class="col-12 text-center">
                                        <button type="submit" id="submit-donation" class="form-control btn1">Submit Donation</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                    
                    <!-- Right: Image -->
                    <div class="col-lg-6 col-12 text-center mt-5 mt-lg-0">
                        {% if publication.pubPicture %}
                        <img class="donation-image img-fluid mb-4" src="{{ publication.pubPicture.url }}" alt="{{ publication.title }}">
                        {% endif %}
                        <div class="custom-block-body">
                            <h5 class="text-white mt-3 mb-3">DONATE NOW</h5>
                            <h4 class="text-white">{{ publication.title }}</h4>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <div style="height: 50px;"></div>
            <div class="badges-wrapper">
    <div class="badges-card">

        <h3 class="badges-title">
            <span style="font-size: 38px; margin-right: 8px;">üèÖ</span>
            Your Badges
        </h3>

        <p class="badges-subtitle">Every donation makes you rise to a new level üíô</p>

        <div class="badges-grid">
            {% for b in badges %}
                <div class="badge-card">
                    {% if b.badge == "bronze" %}
                        <div class="badge-icon badge-bronze">ü•â</div>
                        <div class="badge-name badge-bronze">Bronze Donor</div>

                    {% elif b.badge == "silver" %}
                        <div class="badge-icon badge-silver">ü•à</div>
                        <div class="badge-name badge-silver">Silver Donor</div>

                    {% elif b.badge == "gold" %}
                        <div class="badge-icon badge-gold">ü•á</div>
                        <div class="badge-name badge-gold">Gold Donor</div>

                    {% elif b.badge == "hero" %}
                        <div class="badge-icon badge-hero">ü¶∏‚Äç‚ôÇÔ∏è</div>
                        <div class="badge-name badge-hero">Hero Donor</div>
                    {% endif %}
                </div>
            {% endfor %}
        </div>

    </div>
</div>
        <div style="height: 50px;"></div>
        <!-- User Donations List -->
       <section id="mydonation" style="padding: 70px 0; background: #f4f9f9;">
    <div class="container donations-wrapper">

        <h2 class="donations-title">Your Donations</h2>

        <div class="donations-grid">

            {% for donation in user_donations %}

            <div class="donation-item 
    {% if donation.statut == 'valide' %} valide
    {% elif donation.statut == 'echec' %} echec
    {% else %} attente {% endif %}">

    <div style="display:flex; gap:20px; align-items:flex-start;">

        <!-- IMAGE √Ä GAUCHE -->
        <div>
            {% if donation.id_publication.pubPicture %}
                <img src="{{ donation.id_publication.pubPicture.url }}" 
                     class="donation-left-image">
            {% else %}
                <img src="{% static 'Front/assets/images/default.jpg' %}"
                     class="donation-left-image">
            {% endif %}
        </div>

        <!-- TEXTES -->
        <div style="flex:1;">
            
            <!-- Title + Status -->
            <div class="donation-title-row">
                <h5 class="donation-title">{{ donation.id_publication.title }}</h5>

                {% if donation.statut == 'valide' %}
                    <span class="badge-status badge-valide">‚úÖ Valid√©</span>
                {% elif donation.statut == 'echec' %}
                    <span class="badge-status badge-echec">‚ùå √âchec</span>
                {% else %}
                    <span class="badge-status badge-attente">‚è≥ En attente</span>
                {% endif %}
            </div>

            <!-- Icons Row -->
            <!-- Icons Row -->
<div class="donation-icons">

    {% if donation.type_donation == 'argent' %}
        <!-- Type don : argent -->
        <span>üíµ Argent</span>

        {% if donation.methode_paiement == 'stripe' %}
            <span>üí≥ Stripe</span>

        {% elif donation.methode_paiement == 'cheque' %}
            <span>üßæ Ch√®que</span>

        {% elif donation.methode_paiement == 'paypal' %}
            <span>üÖøÔ∏è PayPal</span>

        {% else %}
            <!-- fallback -->
            <span>üí≥ {{ donation.methode_paiement|title }}</span>
        {% endif %}

    {% else %}
        <!-- Volontariat -->
        <span>ü§ù Volontariat</span>
    {% endif %}

</div>


            <div class="separator-line"></div>

            <!-- Amount + Delete -->
            <div class="amount-row">

                {% if donation.type_donation == 'argent' %}
                    <span class="amount-text">{{ donation.montant }} DT</span>
                {% else %}
                    <span class="amount-text" style="font-size: 1.1rem;">Volontariat</span>
                {% endif %}

                <div class="donation-actions text-end mt-auto"> <button type="button" class="delete-btn" 
        data-donation-id="{{ donation.id_donation }}"
        data-publication-id="{{ donation.id_publication.id }}">
    <i class="fas fa-trash"></i>
</button>
 </div>

            </div>

        </div>
    </div>

</div>  <!-- ‚ùó FIN DE LA CARD -->

            {% empty %}
            <p class="text-center">No donations found.</p>
            {% endfor %}

        </div>

    </div>
    <div class="pagination d-flex justify-content-center mt-4">
    <nav>
        <ul class="pagination">

            {% if page_obj.has_previous %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ page_obj.previous_page_number }}">¬´</a>
                </li>
            {% endif %}

            {% for num in page_obj.paginator.page_range %}
                <li class="page-item {% if page_obj.number == num %}active{% endif %}">
                    <a class="page-link" href="?page={{ num }}">{{ num }}</a>
                </li>
            {% endfor %}

            {% if page_obj.has_next %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ page_obj.next_page_number }}">¬ª</a>
                </li>
            {% endif %}

        </ul>
    </nav>
</div>

</section>

<div class="modal fade" id="deleteDonationModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered" style="max-width: 520px;">
    <div class="modal-content" style="border-radius: 18px;">

      <!-- HEADER -->
      <div class="modal-header" style="
            background: linear-gradient(135deg, #dc3545, #c82333);
            color: white; padding: 10px 18px;
            border-top-left-radius: 18px;
            border-top-right-radius: 18px;
        ">
        <h6 class="modal-title d-flex align-items-center" style="font-size: 16px;">
          <i data-feather="alert-triangle" class="me-2" style="width:18px;height:18px;"></i>
          Delete Donation
        </h6>
        <button class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>

      <!-- BODY -->
      <div class="modal-body text-center" style="padding: 25px 20px;">

        <!-- ICON -->
        <div style="
            background: white;
            width: 70px; height: 70px;
            border-radius: 50%;
            margin: 0 auto 15px;
            display: flex; justify-content: center; align-items: center;
            box-shadow: 0 8px 18px rgba(220,53,69,0.3);
        ">
            <i data-feather="trash-2" style="width: 32px; height: 32px; color:#dc3545;"></i>
        </div>

        <h5 style="font-size: 17px; margin-bottom: 12px;">
            Are you sure you want to delete this donation?
        </h5>

        <img id="modalDonationImg" class="img-fluid rounded mb-2"
             style="max-width: 110px; max-height: 110px; object-fit: cover;">

        <p class="text-muted mb-2" style="font-size: 14px;">
            <strong>Publication:</strong> <span id="modalDonationTitle"></span><br>
            <strong>Amount:</strong> <span id="modalDonationAmount"></span>
        </p>

        <p class="text-danger mt-2" style="font-size: 13px;">
          <i data-feather="alert-circle" style="width: 14px; height: 14px;"></i>
          This action cannot be undone.
        </p>

      </div>

      <!-- FOOTER -->
      <div class="modal-footer" style="padding: 10px 16px;">
        <button class="btn btn-secondary btn-sm" data-bs-dismiss="modal" style="padding:6px 18px;">
            Cancel
        </button>

        <form id="deleteDonationForm" method="post">
          {% csrf_token %}
          <button class="btn btn-danger btn-sm" style="padding:6px 18px;">
            <i data-feather="trash-2" class="me-1"></i>
            Delete
          </button>
        </form>
      </div>

    </div>
  </div>
</div>



    </main>

    

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
    // ========== Toggle donation type fields (Argent / Volontariat) ==========
    const typeSelect = document.getElementById('id_type_donation');
    const montantField = document.getElementById('montant_field');
    const methodeField = document.getElementById('methode_field');
    const descriptionField = document.getElementById('description_field');
    
    function toggleFields() {
        if (!typeSelect) return;
        
        const selectedType = typeSelect.value;
        
        if (selectedType === 'argent') {
            if (montantField) montantField.style.display = 'block';
            if (methodeField) methodeField.style.display = 'block';
            if (descriptionField) descriptionField.style.display = 'none';
            
            const descInput = document.getElementById('id_description');
            if (descInput) {
                descInput.value = '';
                descInput.classList.remove('is-valid', 'is-invalid');
            }
        } else if (selectedType === 'volontariat') {
            if (montantField) montantField.style.display = 'none';
            if (methodeField) methodeField.style.display = 'none';
            if (descriptionField) descriptionField.style.display = 'block';
            
            const montantInput = document.getElementById('id_montant');
            const methodeSelect = document.getElementById('id_methode_paiement');
            if (montantInput) {
                montantInput.value = '';
                montantInput.classList.remove('is-valid', 'is-invalid');
            }
            if (methodeSelect) methodeSelect.selectedIndex = 0;
        } else {
            if (montantField) montantField.style.display = 'none';
            if (methodeField) methodeField.style.display = 'none';
            if (descriptionField) descriptionField.style.display = 'none';
        }
    }
    
    if (typeSelect) {
        typeSelect.addEventListener('change', toggleFields);
    }
    
    window.addEventListener('DOMContentLoaded', function() {
        toggleFields();
    });
    
    // ========== Validation pour Description (min 30 caract√®res) ==========
    const descriptionInput = document.getElementById('id_description');
    const charCount = document.getElementById('char-count');
    const charCounter = document.getElementById('char-counter');
    
    function validateDescription() {
        if (!descriptionInput) return true;
        
        const value = descriptionInput.value.trim();
        const length = value.length;
        
        // Mise √† jour du compteur
        if (charCount) charCount.textContent = length;
        
        if (length === 0) {
            descriptionInput.classList.remove('is-valid', 'is-invalid');
            if (charCounter) charCounter.classList.remove('text-success', 'text-danger');
            return false;
        } else if (length < 30) {
            descriptionInput.classList.remove('is-valid');
            descriptionInput.classList.add('is-invalid');
            if (charCounter) {
                charCounter.classList.remove('text-success');
                charCounter.classList.add('text-danger');
            }
            return false;
        } else {
            descriptionInput.classList.remove('is-invalid');
            descriptionInput.classList.add('is-valid');
            if (charCounter) {
                charCounter.classList.remove('text-danger');
                charCounter.classList.add('text-success');
            }
            return true;
        }
    }
    
    if (descriptionInput) {
        descriptionInput.addEventListener('input', validateDescription);
        descriptionInput.addEventListener('blur', validateDescription);
    }
    
    // ========== Validation pour Montant (> 0) ==========
    const montantInput = document.getElementById('id_montant');
    
    function validateMontant() {
        if (!montantInput) return true;
        
        const value = parseFloat(montantInput.value);
        
        if (isNaN(value) || value <= 0) {
            montantInput.classList.remove('is-valid');
            montantInput.classList.add('is-invalid');
            return false;
        } else {
            montantInput.classList.remove('is-invalid');
            montantInput.classList.add('is-valid');
            return true;
        }
    }
    
    if (montantInput) {
        montantInput.addEventListener('input', function() {
            validateMontant();
            updateUSDEstimate();
        });
        montantInput.addEventListener('blur', validateMontant);
    }
    
    // ========== Validation du formulaire avant soumission ==========
   // ========== Validation du formulaire avant soumission ==========
const donationForm = document.getElementById('donation_form');
const methodSelect = document.getElementById('id_methode_paiement');  // üëà ajout√© ici

if (donationForm) {
    donationForm.addEventListener('submit', function(e) {
        let isValid = true;
        const selectedType = typeSelect.value;

        if (selectedType === 'argent') {
            // ‚ö† On laisse STRIPE g√©rer le cas "argent + stripe"
            if (methodSelect && methodSelect.value !== 'stripe') {
                if (!validateMontant()) {
                    isValid = false;
                    alert('Veuillez entrer un montant valide (sup√©rieur √† 0).');
                }
            }
        } else if (selectedType === 'volontariat') {
            if (!validateDescription()) {
                isValid = false;
                alert('La description doit contenir au moins 30 caract√®res.');
            }
        } else {
            isValid = false;
            alert('Veuillez s√©lectionner un type de donation.');
        }

        if (!isValid) {
            e.preventDefault();
        }
    });
}

    // ========== Delete modal ==========
    
    
    // ========== Amount buttons ==========
    const buttons = document.querySelectorAll('.amount-btn');
    const usdEstimate = document.getElementById('usd_estimate');
    const tauxUSD = 0.32;
    
    function updateUSDEstimate() {
        if (!montantInput) return;
        const montantDT = parseFloat(montantInput.value);
        if (!isNaN(montantDT) && montantDT > 0) {
            const montantUSD = (montantDT * tauxUSD).toFixed(2);
            if (usdEstimate) usdEstimate.textContent = `‚âà $${montantUSD} USD`;
        } else {
            if (usdEstimate) usdEstimate.textContent = '';
        }
    }
    
    buttons.forEach(btn => {
        btn.addEventListener('click', () => {
            buttons.forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            if (montantInput) {
                montantInput.value = btn.getAttribute('data-value');
                validateMontant();
                updateUSDEstimate();
            }
        });
    });
    
    // ========== Card logos + zone Stripe toggle ==========
// ========== Card logos + zone Stripe toggle ==========
const logos = document.getElementById('card-logos');
const stripeSection = document.getElementById('stripe-payment-section');


function toggleCardLogos() {
    if (!methodSelect) return;

    if (methodSelect.value === 'stripe') {
        if (logos) logos.style.display = 'block';
        if (stripeSection) stripeSection.style.display = 'block';
    } else {
        if (logos) logos.style.display = 'none';
        if (stripeSection) stripeSection.style.display = 'none';
    }
}

if (methodSelect) {
    methodSelect.addEventListener('change', toggleCardLogos);
    window.addEventListener('DOMContentLoaded', toggleCardLogos);
}

    
    // ========== Scroll to donations after form submission ==========
    const messages = document.querySelector('.alert-success');
    if (messages) {
        setTimeout(() => {
            const donationSection = document.getElementById('mydonation');
            if (donationSection) {
                donationSection.scrollIntoView({behavior: 'smooth'});
            }
        }, 500);
    }




    document.querySelectorAll('.delete-btn').forEach(btn => {
    btn.addEventListener('click', function () {

        const donationId = this.dataset.donationId;

        // Inject dans formulaire
        document.getElementById('deleteDonationForm').action =
            `/donation/delete/${donationId}/`;

        // Inject infos d'affichage
        const card = this.closest('.donation-item');

        document.getElementById('modalDonationImg').src =
            card.querySelector('.donation-left-image').src;

        document.getElementById('modalDonationTitle').textContent =
            card.querySelector('.donation-title').textContent;

        document.getElementById('modalDonationAmount').textContent =
            card.querySelector('.amount-text').textContent;

        // Ouvre TON modal custom (PAS le modal Bootstrap basic)
        const modal = new bootstrap.Modal(document.getElementById('deleteDonationModal'));
        modal.show();
    });
});



</script>

<script src="https://unpkg.com/feather-icons"></script>
<script>
    feather.replace();
</script>


</html>
